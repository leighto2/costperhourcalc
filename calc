<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cost Per Billable Hour & Profitability Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .input-highlight {
            background-color: #FFFDE7; /* A light yellow */
        }
        .result-card {
            transition: all 0.3s ease-in-out;
        }
        .result-value {
            transition: all 0.3s ease-in-out;
        }
        .dynamic-value {
            transition: background-color 0.3s ease-in-out;
        }
        @media print {
            body {
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            .no-print {
                display: none;
            }
            section {
                box-shadow: none !important;
                border: 1px solid #e2e8f0 !important;
                page-break-inside: avoid;
            }
            .container {
                padding: 0 !important;
                max-width: 100% !important;
            }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8 max-w-4xl">
        <header class="text-center mb-8 flex flex-col sm:flex-row justify-between items-center">
            <div>
                <h1 class="text-3xl sm:text-4xl font-bold text-gray-900">Dynamic Cost & Profitability Calculator</h1>
                <p class="mt-2 text-lg text-gray-600">Model how changes in staffing, pay, loans, and hours affect your bottom line.</p>
            </div>
            <button id="printButton" class="no-print mt-4 sm:mt-0 bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 transition duration-300 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M5 4v3H4a2 2 0 00-2 2v6a2 2 0 002 2h12a2 2 0 002-2V9a2 2 0 00-2-2h-1V4a2 2 0 00-2-2H7a2 2 0 00-2 2zm8 0H7v3h6V4zm0 8H7V9h6v3z" clip-rule="evenodd" />
                </svg>
                Print / Save as PDF
            </button>
        </header>

        <div class="space-y-8">
            <!-- Section 1: Annual Cost Breakdown -->
            <section class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
                <h2 class="text-2xl font-semibold text-gray-800 border-b pb-3 mb-4 flex items-center">
                    <span class="bg-blue-500 text-white rounded-full h-8 w-8 text-lg font-bold flex items-center justify-center mr-3">1</span>
                    Annual Cost Summary
                </h2>
                <p class="text-gray-600 mb-6 no-print">This section summarizes all costs based on your inputs below.</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-center">
                    <div class="bg-gray-100 p-4 rounded-lg dynamic-value">
                        <h3 class="text-sm font-medium text-gray-500 uppercase tracking-wider">Total Employee Costs</h3>
                        <p id="totalEmployeeCost" class="text-2xl font-bold text-blue-600 mt-1"></p>
                         <p class="text-xs text-gray-500 mt-1">(Billable & Admin Staff)</p>
                    </div>
                    <div class="bg-blue-100 p-4 rounded-lg border border-blue-200 dynamic-value">
                        <h3 class="text-sm font-medium text-blue-700 uppercase tracking-wider">Total Annual Costs</h3>
                        <p id="totalAnnualCost" class="text-2xl font-bold text-blue-800 mt-1"></p>
                        <p class="text-xs text-blue-600 mt-1">(All Business Costs)</p>
                    </div>
                </div>
            </section>

            <!-- Section 2: Staffing & Pay Rates -->
            <section class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
                <h2 class="text-2xl font-semibold text-gray-800 border-b pb-3 mb-4 flex items-center">
                    <span class="bg-green-500 text-white rounded-full h-8 w-8 text-lg font-bold flex items-center justify-center mr-3">2</span>
                    Staffing & Pay Rates
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6">
                    <!-- Billable Employees -->
                    <div class="space-y-4 rounded-lg border border-gray-200 p-4">
                        <h3 class="font-medium text-gray-800">Billable Service Staff</h3>
                        <div>
                            <label for="numBillableEmployees" class="block text-sm font-medium text-gray-700">Number of Billable Employees</label>
                            <input type="number" id="numBillableEmployees" value="8" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 input-highlight">
                        </div>
                        <div>
                            <label for="avgBillablePay" class="block text-sm font-medium text-gray-700">Avg. Hourly Pay Rate ($)</label>
                            <input type="number" id="avgBillablePay" value="40" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 input-highlight">
                        </div>
                    </div>
                    <!-- Admin Employees -->
                    <div class="space-y-4 rounded-lg border border-gray-200 p-4">
                        <h3 class="font-medium text-gray-800">Administrative Staff</h3>
                        <div>
                           <label for="numAdminEmployees" class="block text-sm font-medium text-gray-700">Number of Admin Employees</label>
                           <input type="number" id="numAdminEmployees" value="2" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 input-highlight">
                        </div>
                        <div>
                            <label for="avgAdminPay" class="block text-sm font-medium text-gray-700">Avg. Hourly Pay Rate ($)</label>
                            <input type="number" id="avgAdminPay" value="25" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 input-highlight">
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section 3: Overhead & Loans -->
            <section class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
                <h2 class="text-2xl font-semibold text-gray-800 border-b pb-3 mb-4 flex items-center">
                    <span class="bg-orange-500 text-white rounded-full h-8 w-8 text-lg font-bold flex items-center justify-center mr-3">3</span>
                    Business Overhead & Loans
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6">
                    <div>
                        <label for="fixedOverhead" class="block text-sm font-medium text-gray-700">Annual Fixed Overhead ($)</label>
                        <input type="number" id="fixedOverhead" value="301046.62" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 input-highlight">
                        <p class="text-xs text-gray-500 mt-1">Rent, utilities, software, etc. Excludes all payroll and loan payments.</p>
                    </div>
                    <div>
                        <label for="totalLoanPayments" class="block text-sm font-medium text-gray-700">Total Annual Loan Payments ($)</label>
                        <input type="number" id="totalLoanPayments" value="47923.79" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 input-highlight">
                        <p class="text-xs text-gray-500 mt-1">Total cash paid (Principal + Interest).</p>
                    </div>
                </div>
            </section>

            <!-- Section 4: Hours & Utilization -->
             <section class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
                <h2 class="text-2xl font-semibold text-gray-800 border-b pb-3 mb-4 flex items-center">
                    <span class="bg-yellow-500 text-white rounded-full h-8 w-8 text-lg font-bold flex items-center justify-center mr-3">4</span>
                    Hours & Utilization (Per Billable Employee)
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4">
                    <div>
                        <label for="hoursPerWeek" class="block text-sm font-medium text-gray-700">Standard Work Hours per Week</label>
                        <input type="number" id="hoursPerWeek" value="40" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 input-highlight">
                    </div>
                     <div>
                        <label for="billableTravelHours" class="block text-sm font-medium text-gray-700">Weekly Billable Travel Hours</label>
                        <input type="number" id="billableTravelHours" value="4" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 input-highlight">
                    </div>
                    <div>
                        <label for="otherNonBillableHours" class="block text-sm font-medium text-gray-700">Weekly *Other* Non-Billable Hours (Admin)</label>
                        <input type="number" id="otherNonBillableHours" value="4" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 input-highlight">
                    </div>
                     <div>
                        <label for="vacationDays" class="block text-sm font-medium text-gray-700">Annual Vacation Days</label>
                        <input type="number" id="vacationDays" value="15" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 input-highlight">
                    </div>
                     <div>
                        <label for="holidayDays" class="block text-sm font-medium text-gray-700">Annual Paid Public Holidays</label>
                        <input type="number" id="holidayDays" value="10" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 input-highlight">
                    </div>
                    <div>
                        <label for="sickDays" class="block text-sm font-medium text-gray-700">Annual Sick / Personal Days</p></label>
                        <input type="number" id="sickDays" value="5" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 input-highlight">
                    </div>
                </div>
            </section>
            
            <!-- Section 5: Profitability Analysis -->
            <section class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
                <h2 class="text-2xl font-semibold text-gray-800 border-b pb-3 mb-4 flex items-center">
                    <span class="bg-purple-500 text-white rounded-full h-8 w-8 text-lg font-bold flex items-center justify-center mr-3">5</span>
                    Profitability Analysis
                </h2>
                <div class="space-y-6">
                     <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6">
                        <div>
                            <label for="targetBillRate" class="block text-sm font-medium text-gray-700">Primary Service Bill Rate ($/hr)</label>
                            <input type="number" id="targetBillRate" value="150" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 input-highlight">
                        </div>
                        <div>
                            <label for="travelBillRate" class="block text-sm font-medium text-gray-700">Billable Travel Rate ($/hr)</label>
                            <input type="number" id="travelBillRate" value="75" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 input-highlight">
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                         <div class="bg-purple-50 p-4 rounded-lg text-center border border-purple-200">
                            <h3 class="text-sm font-medium text-purple-700 uppercase tracking-wider">Overall Profit Margin</h3>
                            <p id="profitMargin" class="text-2xl font-bold text-purple-600 mt-1"></p>
                        </div>
                        <div class="bg-purple-50 p-4 rounded-lg text-center border border-purple-200">
                            <h3 class="text-sm font-medium text-purple-700 uppercase tracking-wider">Avg. Profit Per Service Hour</h3>
                            <p id="profitPerHour" class="text-2xl font-bold text-purple-600 mt-1"></p>
                        </div>
                        <div class="bg-purple-50 p-4 rounded-lg text-center border border-purple-200">
                            <h3 class="text-sm font-medium text-purple-700 uppercase tracking-wider">Total Annual Profit</h3>
                            <p id="totalAnnualProfit" class="text-2xl font-bold text-purple-600 mt-1"></p>
                        </div>
                    </div>
                </div>
            </section>


            <!-- Section 6: Final Report -->
            <section id="finalReport" class="bg-gray-800 text-white p-6 rounded-xl shadow-lg">
                 <h2 class="text-2xl font-semibold text-white border-b border-gray-600 pb-3 mb-6 flex items-center">
                    <span class="bg-white text-gray-800 rounded-full h-8 w-8 text-lg font-bold flex items-center justify-center mr-3">6</span>
                    Final Cost & Hours Report
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Left side: The Final Cost -->
                    <div class="bg-white text-gray-900 rounded-lg p-6 flex flex-col items-center justify-center result-card">
                         <h3 class="text-lg font-semibold text-gray-700 uppercase tracking-wider">True Cost Per Billable Hour</h3>
                         <p id="costPerHour" class="text-5xl lg:text-6xl font-bold text-green-600 my-2 result-value"></p>
                         <p class="text-sm text-gray-500">(Total Annual Costs / Total Service Hours)</p>
                    </div>
                    <!-- Right side: Billable Hours Breakdown -->
                    <div class="space-y-4 my-auto">
                        <div class="flex justify-between items-baseline">
                            <span class="text-gray-300">Total Primary Service Hours:</span>
                            <span id="totalBillableHours" class="text-2xl font-bold text-green-300"></span>
                        </div>
                        <div class="flex justify-between items-baseline">
                             <span class="text-gray-300">Service Hours per Employee:</span>
                            <span id="billableHoursPerEmployee" class="text-lg font-medium text-white"></span>
                        </div>
                         <div class="flex justify-between items-baseline">
                            <span class="text-gray-300">Utilization Rate (Service Time):</span>
                            <span id="utilizationRate" class="text-lg font-medium text-white"></span>
                        </div>
                         <div class="text-xs text-gray-400 pt-2 border-t border-gray-600">
                            Calculation: (Available Hours - PTO - All Non-Service Time)
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <script>
        // --- Constants derived from the P&L ---
        const EMPLOYEE_BURDEN_MULTIPLIER = 1.1868;

        // --- Get references to all DOM elements ---
        const inputs = {
            numBillableEmployees: document.getElementById('numBillableEmployees'),
            avgBillablePay: document.getElementById('avgBillablePay'),
            numAdminEmployees: document.getElementById('numAdminEmployees'),
            avgAdminPay: document.getElementById('avgAdminPay'),
            fixedOverhead: document.getElementById('fixedOverhead'),
            totalLoanPayments: document.getElementById('totalLoanPayments'),
            hoursPerWeek: document.getElementById('hoursPerWeek'),
            vacationDays: document.getElementById('vacationDays'),
            holidayDays: document.getElementById('holidayDays'),
            sickDays: document.getElementById('sickDays'),
            billableTravelHours: document.getElementById('billableTravelHours'),
            otherNonBillableHours: document.getElementById('otherNonBillableHours'),
            targetBillRate: document.getElementById('targetBillRate'),
            travelBillRate: document.getElementById('travelBillRate'),
        };

        const outputs = {
            totalEmployeeCost: document.getElementById('totalEmployeeCost'),
            totalAnnualCost: document.getElementById('totalAnnualCost'),
            totalBillableHours: document.getElementById('totalBillableHours'),
            billableHoursPerEmployee: document.getElementById('billableHoursPerEmployee'),
            utilizationRate: document.getElementById('utilizationRate'),
            costPerHour: document.getElementById('costPerHour'),
            profitMargin: document.getElementById('profitMargin'),
            profitPerHour: document.getElementById('profitPerHour'),
            totalAnnualProfit: document.getElementById('totalAnnualProfit'),
        };
        
        const resultCard = document.querySelector('.result-card');
        const printButton = document.getElementById('printButton');

        // --- Main calculation function ---
        function calculate() {
            // Get values from input fields
            const numBillableEmployees = parseFloat(inputs.numBillableEmployees.value) || 0;
            const avgBillablePay = parseFloat(inputs.avgBillablePay.value) || 0;
            const numAdminEmployees = parseFloat(inputs.numAdminEmployees.value) || 0;
            const avgAdminPay = parseFloat(inputs.avgAdminPay.value) || 0;
            const fixedOverhead = parseFloat(inputs.fixedOverhead.value) || 0;
            const totalLoanPayments = parseFloat(inputs.totalLoanPayments.value) || 0;
            const hoursPerWeek = parseFloat(inputs.hoursPerWeek.value) || 0;
            const vacationDays = parseFloat(inputs.vacationDays.value) || 0;
            const holidayDays = parseFloat(inputs.holidayDays.value) || 0;
            const sickDays = parseFloat(inputs.sickDays.value) || 0;
            const weeklyBillableTravel = parseFloat(inputs.billableTravelHours.value) || 0;
            const weeklyOtherNonBillable = parseFloat(inputs.otherNonBillableHours.value) || 0;
            const targetBillRate = parseFloat(inputs.targetBillRate.value) || 0;
            const travelBillRate = parseFloat(inputs.travelBillRate.value) || 0;

            // --- Cost Calculations ---
            const annualBillableWages = numBillableEmployees * avgBillablePay * hoursPerWeek * 52;
            const annualAdminWages = numAdminEmployees * avgAdminPay * hoursPerWeek * 52;
            const totalGrossWages = annualBillableWages + annualAdminWages;
            const totalEmployeeCost = totalGrossWages * EMPLOYEE_BURDEN_MULTIPLIER;
            const totalAnnualCost = fixedOverhead + totalEmployeeCost + totalLoanPayments;

            // --- Hours Calculations (per billable employee) ---
            const totalPotentialHours = hoursPerWeek * 52;
            const totalPtoDays = vacationDays + holidayDays + sickDays;
            const ptoHours = totalPtoDays * (hoursPerWeek / 5); 
            const workingWeeks = 52 - (totalPtoDays / 5);
            
            const annualBillableTravelHours = weeklyBillableTravel * workingWeeks;
            const annualOtherNonBillableHours = weeklyOtherNonBillable * workingWeeks;

            const billableServiceHoursPerEmployee = totalPotentialHours - ptoHours - annualBillableTravelHours - annualOtherNonBillableHours;
            const totalBillableServiceHours = billableServiceHoursPerEmployee * numBillableEmployees;

            // --- Revenue & Profit Calculations ---
            const serviceRevenue = totalBillableServiceHours * targetBillRate;
            const travelRevenue = (annualBillableTravelHours * numBillableEmployees) * travelBillRate;
            const totalAnnualRevenue = serviceRevenue + travelRevenue;
            const totalAnnualProfit = totalAnnualRevenue - totalAnnualCost;

            // --- Final Metric Calculations ---
            const utilization = totalPotentialHours > 0 ? (billableServiceHoursPerEmployee / totalPotentialHours) * 100 : 0;
            const costPerHour = totalBillableServiceHours > 0 ? totalAnnualCost / totalBillableServiceHours : 0;
            const profitPerHour = totalBillableServiceHours > 0 ? totalAnnualProfit / totalBillableServiceHours : 0;
            const profitMargin = totalAnnualRevenue > 0 ? (totalAnnualProfit / totalAnnualRevenue) * 100 : 0;
            
            // --- Update UI ---
            const currencyFormatter = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' });
            const numberFormatter = new Intl.NumberFormat('en-US', { maximumFractionDigits: 0 });
            
            outputs.totalEmployeeCost.textContent = currencyFormatter.format(totalEmployeeCost);
            outputs.totalAnnualCost.textContent = currencyFormatter.format(totalAnnualCost);
            
            if (totalBillableServiceHours >= 0) {
                outputs.totalBillableHours.textContent = numberFormatter.format(totalBillableServiceHours);
                outputs.billableHoursPerEmployee.textContent = `${numberFormatter.format(billableServiceHoursPerEmployee)} hrs`;
                outputs.utilizationRate.textContent = `${utilization.toFixed(1)}%`;
                outputs.costPerHour.textContent = currencyFormatter.format(costPerHour);
                outputs.profitMargin.textContent = `${profitMargin.toFixed(1)}%`;
                outputs.profitPerHour.textContent = currencyFormatter.format(profitPerHour);
                outputs.totalAnnualProfit.textContent = currencyFormatter.format(totalAnnualProfit);
            } else {
                outputs.totalBillableHours.textContent = '0';
                outputs.billableHoursPerEmployee.textContent = '0 hrs';
                outputs.utilizationRate.textContent = '0.0%';
                outputs.costPerHour.textContent = '$0.00';
                outputs.profitMargin.textContent = '0.0%';
                outputs.profitPerHour.textContent = '$0.00';
                outputs.totalAnnualProfit.textContent = currencyFormatter.format(totalAnnualProfit);
            }
            
            resultCard.classList.remove('scale-105');
            void resultCard.offsetWidth;
            resultCard.classList.add('scale-105');
            
            document.querySelectorAll('.dynamic-value').forEach(el => {
                el.classList.add('bg-blue-50');
                setTimeout(() => el.classList.remove('bg-blue-50'), 500);
            });
        }

        // --- Event Listeners ---
        Object.values(inputs).forEach(input => {
            input.addEventListener('input', calculate);
        });

        printButton.addEventListener('click', () => {
            window.print();
        });

        // Initial calculation on page load
        window.addEventListener('load', calculate);

    </script>
</body>
</html>
